<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KrakenDuty - Multiple Scenarios at once - Script Generator</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'> </text></svg>">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header class="title-group">
        <h1 class="main-title">KrakenDuty</h1>
        <h1 class="sub-title">PagerDuty Event V2 Sender <span class="version">v1.7 (unofficial)</span></h1>
        <h2>Multiple Scenarios at once - Script Generator</h2>
    </header>

    <div class="section">
        <h2>Common Fields <span class="subtext">Will be applied to every event</span></h2>
        <div id="routing-key-field" class="field">
            <label for="routing_key">Routing Key:</label>
            <div class="routing-key-container" style="flex: 1;">
                <input type="text" id="routing_key" placeholder="PASTE YOUR ROUTING KEY HERE">
                <div id="routing-key-dropdown" class="routing-key-dropdown"></div>
                <div class="routing-key-actions">
                    <button type="button" class="routing-key-save" onclick="saveCurrentRoutingKey()">Save Key</button>
                    <button type="button" class="routing-key-load" onclick="toggleRoutingKeyDropdown()">Load
                        Key</button>
                    <button type="button" class="routing-key-load" onclick="manageRoutingKeysUI()">Manage Keys</button>
                </div>
            </div>
        </div>
        <div id="event-action-field" class="field">
            <label for="event_action">Event Action:</label>
            <select id="event_action" onchange="toggleDedupKeyField()">
                <option value="trigger">Trigger</option>
                <option value="acknowledge">Acknowledge</option>
                <option value="resolve">Resolve</option>
            </select>
            <label for="dedup_key_for_trigger" class="checkbox-label" id="dedup-key-checkbox-label">
                <input type="checkbox" id="dedup_key_for_trigger" onchange="toggleDedupKeyField()">
                <span>OPTIONAL: Wanna use your own dedup key?</span>
            </label>
        </div>
        <div id="dedup-key-field" class="field" style="display: none;">
            <label for="dedup_key">Dedup Key:</label>
            <input type="text" id="dedup_key" placeholder="Enter your dedup key" oninput="toggleDedupKeyField()">
        </div>
        <div id="dedup-key-error" class="error-message" style="display: none;"></div>
        <input type="hidden" id="client" value="KrakenDuty">
    </div>

    <div class="section">
        <h2>
            Scenarios <span class="subtext">Go nuts!</span>
            <span id="scenario-display"
                style="display: none; margin-left: 15px; font-size: 0.7em; color: #666; font-weight: normal;"></span>
        </h2>
        <div id="scenarios-container"></div>
        <div class="scenario-actions">
            <button class="save-all-scenarios" onclick="addScenario()">Add Scenario</button>
            <button class="save-all-scenarios" onclick="clearAllScenariosUI()">Clear All Scenarios</button>
        </div>
        <div class="scenario-set-actions">
            <button class="save-all-scenarios" onclick="saveScenarioSet()">Save Scenario Set</button>
            <button class="save-all-scenarios" onclick="loadScenarioSetUI()">Load Scenario Set</button>
            <button class="save-all-scenarios" onclick="manageScenarioSetsUI()">Manage Scenario Sets</button>
        </div>
    </div>

    <button id="sendEventsBtn" onclick="sendEvents()">Release the Kraken!  </button>
    <button id="showPayloadBtn" onclick="showPayload()">Show Payload</button>
    <button id="hidePayloadBtn" onclick="hidePayload()" style="display: none;">Hide Payload</button>

    <div id="error-container"></div>
    <div id="result"></div>

    <div id="payload-preview" style="display: none;">
        <h3>Payload Preview</h3>
        <div class="payload-actions">
            <div class="button-group">
                <button id="downloadShellScriptBtn" onclick="downloadShellScript()">Download Shell Script</button>
                <span class="download-info">Download a shell script with desired scenario(s) to send events via command
                    line .</span>
            </div>
        </div>
        <pre class="payload-preview"></pre>
    </div>

    <div class="bug-report">
        <p>Found a bug? / Have an idea? <a href="https://github.com/jplassnibatt/pd_events/issues" target="_blank"
                rel="noopener noreferrer">Open an issue on GitHub</a></p>
        <p style="margin-top: 10px; font-size: 0.9em;">
            <img src="https://visitor-badge.laobi.icu/badge?page_id=jplassnibatt.pd_events.scenarios" alt="Visitors"
                style="vertical-align: middle; margin-right: 15px;">
             Krakens Released: <strong><span id="kraken-count">0</span></strong>
        </p>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Application Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/app.js"></script>
</body>

</html>